--WEB-70420-START-RC
GO
 ALTER PROCEDURE dbo.CoreAmlScenarioAlert_GetStatistics    
(    
 @Type VARCHAR(50), -- either 'SystemDate' OR 'RunDate'       
 @FromDate DATETIME,        
 @ToDate DATETIME        
)    
AS        
BEGIN        
    
 CREATE TABLE #Result        
 (        
  [Date] DATETIME,        
  S1 INT,    
  S2 INT,    
  S3 INT,    
  S4 INT,    
  S5 INT,    
  S6 INT,    
  S7 INT,        
  S8 INT,        
  S9 INT,        
  S10 INT,        
  S11 INT,        
  S12 INT,        
  S13 INT,        
  S14 INT,        
  S15 INT,        
  S16 INT,        
  S17 INT,        
  S18 INT,          
  S19 INT,        
  S20 INT,        
  S21 INT,        
  S22 INT,        
  S23 INT,        
  S24 INT,        
  S25 INT,        
  S26 INT,        
  S27 INT,        
  S28 INT,        
  S29 INT,        
  S30 INT,        
  S31 INT,        
  S32 INT,        
  S33 INT,        
  S34 INT,        
  S35 INT,        
  S36 INT,        
  S37 INT,        
  S38 INT,        
  S39 INT,        
  S40 INT,        
  S41 INT,        
  S42 INT,          
  S43 INT,        
  S44 INT,        
  S45 INT,        
  S46 INT,        
  S47 INT,        
  S48 INT,    
  S50 INT,        
  S51 INT,        
  S52 INT,        
  S53 INT,        
  S54 INT,          
  S55 INT,        
  S56 INT,        
  S57 INT,        
  S58 INT,          
  S59 INT,        
  S60 INT,          
  S62 INT,        
  S63 INT,        
  S64 INT,        
  S65 INT,        
  S66 INT,        
  S72 INT,        
  S73 INT,        
  S74 INT,        
  S75 INT,        
  S76 INT,        
  S77 INT,        
  S78 INT,        
  S79 INT,        
  S80 INT,        
  S82 INT,        
  S83 INT,        
  S84 INT,        
  S85 INT,        
  S88 INT,    
  S801 INT,        
  S802 INT,        
  S803 INT,        
  S806 INT,      
  S807 INT,      
  S90 INT,      
  S92 INT,      
  S511 INT,      
  S512 INT,      
  S701 INT,      
  S702 INT,      
  S703 INT,      
  S704 INT,      
  S705 INT,      
  S707 INT,      
  S708 INT,      
  S706 INT,      
  S402 INT,      
  S86 INT,      
  S87 INT,    
  S89 INT,    
  S95 INT,    
  S49 INT,    
  S513 Int ,    
  S401 INT,    
  S501 INT,    
  S502 INT,    
  S503 INT,    
  S504 INT,    
  S505 INT,    
  S506 INT,    
  S507 INT,    
  S508 INT,    
  S509 INT,    
  S510 INT,    
  S817 INT,    
  S91 INT,    
  S96 INT,    
  S97 INT,    
  S98 INT,    
  S808 INT,    
  S809 INT,    
  S810 INT,    
  S811 INT,    
  S812 INT,    
  S514 INT,    
  S515 INT,    
  S517 INT,    
  S516 INT,    
  S99 INT,    
  S520 Int,    
  S522 INT,    
  S101 INT,    
  S804 INT,    
  S103 INT,    
  S100 INT,    
  S521 INT,    
  S519 Int,    
  S108 int,    
  S107 int,    
  S105 int,    
  S106 int,    
  S102 int,    
  S110 int,    
  S104 int,    
  S814 int,    
  S815 int,    
  S111 int,    
  S518 int,    
  S112 int,    
  S114 int,    
  S115 int,    
  S113 int,    
  S116 int,    
  S118 int,    
  S117 int,    
  S119 int,    
  S523 int,    
  S120 int,    
  S122 int,    
  S121 INT,    
  S123 INT,    
  S525 INT,    
  S524 INT,    
  S126 INT,    
  S127 INT,    
  S526 INT,    
  S129 INT,    
  S124 INT,    
  S128 INT,    
  S125 INT,    
  S144 INT,    
  S145 INT,    
  S146 INT,    
  S147 INT,    
  S148 INT,    
  S149 INT,    
  S151 INT,    
  S152 INT,    
  S153 INT,    
  S154 INT,    
  S155 INT,    
  S157 INT,    
  S156 INT,    
  S158 INT,    
  S159 INT,    
  S160 INT,    
  S171 INT,    
  S832 INT,    
  S833 INT,    
  S834 INT,    
  S172 INT,    
  S161 INT,    
  S162 INT,    
  S836 INT,    
  S835 INT,    
  S173 INT,    
  S163 INT,    
  S164 INT,    
  S174 INT,    
  S166 INT,    
  S837 INT,    
  S165 INT,    
  S838 INT,    
  S839 INT,    
  S167 INT,    
  S840 INT,    
  S841 INT,    
  S527 INT,    
  S175 INT,    
  S176 INT,    
  S177 INT,    
  S180 INT,    
  S181 INT,    
  S179 INT,    
  S182 INT,    
  S183 INT,  
  S178 INT,    
  S184 INT,    
  S168 INT,
  S169 INT
 )    
    
-- populate all dates        
 DECLARE @Counter DATETIME        
 SET @Counter = @FromDate        
 WHILE(@Counter <= @ToDate)        
 BEGIN        
  INSERT INTO #Result (Date) VALUES(@Counter)        
  SET @Counter = @Counter + 1        
 END        
    
       
    
-- count the alerts for each scenario        
 SELECT CASE WHEN @Type = 'SystemDate' THEN dbo.GetDateWithoutTime(alert.AddedOn) ELSE dbo.GetDateWithoutTime(alert.ReportDate) END AS [Date],        
 SUM(CASE WHEN report.Code = 'S1' THEN 1 ELSE 0 END) S1,        
 SUM(CASE WHEN report.Code = 'S2' THEN 1 ELSE 0 END) S2,        
 SUM(CASE WHEN report.Code = 'S3' THEN 1 ELSE 0 END) S3,        
 SUM(CASE WHEN report.Code = 'S4' THEN 1 ELSE 0 END) S4,        
 SUM(CASE WHEN report.Code = 'S5' THEN 1 ELSE 0 END) S5,        
 SUM(CASE WHEN report.Code = 'S6' THEN 1 ELSE 0 END) S6,        
 SUM(CASE WHEN report.Code = 'S7' THEN 1 ELSE 0 END) S7,        
 SUM(CASE WHEN report.Code = 'S8' THEN 1 ELSE 0 END) S8,        
 SUM(CASE WHEN report.Code = 'S9' THEN 1 ELSE 0 END) S9,        
 SUM(CASE WHEN report.Code = 'S10' THEN 1 ELSE 0 END) S10,        
 SUM(CASE WHEN report.Code = 'S11' THEN 1 ELSE 0 END) S11,        
 SUM(CASE WHEN report.Code = 'S12' THEN 1 ELSE 0 END) S12,        
 SUM(CASE WHEN report.Code = 'S13' THEN 1 ELSE 0 END) S13,        
 SUM(CASE WHEN report.Code = 'S14' THEN 1 ELSE 0 END) S14,        
 SUM(CASE WHEN report.Code = 'S15' THEN 1 ELSE 0 END) S15,        
 SUM(CASE WHEN report.Code = 'S16' THEN 1 ELSE 0 END) S16,        
 SUM(CASE WHEN report.Code = 'S17' THEN 1 ELSE 0 END) S17,        
 SUM(CASE WHEN report.Code = 'S18' THEN 1 ELSE 0 END) S18,              
 SUM(CASE WHEN report.Code = 'S19' THEN 1 ELSE 0 END) S19,        
 SUM(CASE WHEN report.Code = 'S20' THEN 1 ELSE 0 END) S20,        
 SUM(CASE WHEN report.Code = 'S21' THEN 1 ELSE 0 END) S21,        
 SUM(CASE WHEN report.Code = 'S22' THEN 1 ELSE 0 END) S22,        
 SUM(CASE WHEN report.Code = 'S23' THEN 1 ELSE 0 END) S23,        
 SUM(CASE WHEN report.Code = 'S24' THEN 1 ELSE 0 END) S24,        
 SUM(CASE WHEN report.Code = 'S25' THEN 1 ELSE 0 END) S25,        
 SUM(CASE WHEN report.Code = 'S26' THEN 1 ELSE 0 END) S26,        
 SUM(CASE WHEN report.Code = 'S27' THEN 1 ELSE 0 END) S27,        
 SUM(CASE WHEN report.Code = 'S28' THEN 1 ELSE 0 END) S28,              
 SUM(CASE WHEN report.Code = 'S29' THEN 1 ELSE 0 END) S29,          
 SUM(CASE WHEN report.Code = 'S30' THEN 1 ELSE 0 END) S30,        
 SUM(CASE WHEN report.Code = 'S31' THEN 1 ELSE 0 END) S31,              
 SUM(CASE WHEN report.Code = 'S32' THEN 1 ELSE 0 END) S32,        
 SUM(CASE WHEN report.Code = 'S33' THEN 1 ELSE 0 END) S33,        
 SUM(CASE WHEN report.Code = 'S34' THEN 1 ELSE 0 END) S34,        
 SUM(CASE WHEN report.Code = 'S35' THEN 1 ELSE 0 END) S35,        
 SUM(CASE WHEN report.Code = 'S36' THEN 1 ELSE 0 END) S36,        
 SUM(CASE WHEN report.Code = 'S37' THEN 1 ELSE 0 END) S37,              
 SUM(CASE WHEN report.Code = 'S38' THEN 1 ELSE 0 END) S38,        
 SUM(CASE WHEN report.Code = 'S39' THEN 1 ELSE 0 END) S39,        
 SUM(CASE WHEN report.Code = 'S40' THEN 1 ELSE 0 END) S40,        
 SUM(CASE WHEN report.Code = 'S41' THEN 1 ELSE 0 END) S41,        
 SUM(CASE WHEN report.Code = 'S42' THEN 1 ELSE 0 END) S42,              
 SUM(CASE WHEN report.Code = 'S43' THEN 1 ELSE 0 END) S43,        
 SUM(CASE WHEN report.Code = 'S44' THEN 1 ELSE 0 END) S44,        
 SUM(CASE WHEN report.Code = 'S45' THEN 1 ELSE 0 END) S45,        
 SUM(CASE WHEN report.Code = 'S46' THEN 1 ELSE 0 END) S46,        
 SUM(CASE WHEN report.Code = 'S47' THEN 1 ELSE 0 END) S47,        
 SUM(CASE WHEN report.Code = 'S48' THEN 1 ELSE 0 END) S48,    
 SUM(CASE WHEN report.Code = 'S50' THEN 1 ELSE 0 END) S50,              
 SUM(CASE WHEN report.Code = 'S51' THEN 1 ELSE 0 END) S51,              
 SUM(CASE WHEN report.Code = 'S52' THEN 1 ELSE 0 END) S52,              
 SUM(CASE WHEN report.Code = 'S53' THEN 1 ELSE 0 END) S53,        
 SUM(CASE WHEN report.Code = 'S54' THEN 1 ELSE 0 END) S54,              
 SUM(CASE WHEN report.Code = 'S55' THEN 1 ELSE 0 END) S55,        
 SUM(CASE WHEN report.Code = 'S56' THEN 1 ELSE 0 END) S56,        
 SUM(CASE WHEN report.Code = 'S57' THEN 1 ELSE 0 END) S57,        
 SUM(CASE WHEN report.Code = 'S58' THEN 1 ELSE 0 END) S58,              
 SUM(CASE WHEN report.Code = 'S59' THEN 1 ELSE 0 END) S59,        
 SUM(CASE WHEN report.Code = 'S60' THEN 1 ELSE 0 END) S60,              
 SUM(CASE WHEN report.Code = 'S62' THEN 1 ELSE 0 END) S62,        
 SUM(CASE WHEN report.Code = 'S63' THEN 1 ELSE 0 END) S63,              
 SUM(CASE WHEN report.Code = 'S64' THEN 1 ELSE 0 END) S64,        
 SUM(CASE WHEN report.Code = 'S65' THEN 1 ELSE 0 END) S65,              
 SUM(CASE WHEN report.Code = 'S66' THEN 1 ELSE 0 END) S66,        
 SUM(CASE WHEN report.Code = 'S72' THEN 1 ELSE 0 END) S72,        
 SUM(CASE WHEN report.Code = 'S73' THEN 1 ELSE 0 END) S73,       SUM(CASE WHEN report.Code = 'S74' THEN 1 ELSE 0 END) S74,        
 SUM(CASE WHEN report.Code = 'S75' THEN 1 ELSE 0 END) S75,        
 SUM(CASE WHEN report.Code = 'S76' THEN 1 ELSE 0 END) S76,        
 SUM(CASE WHEN report.Code = 'S77' THEN 1 ELSE 0 END) S77,        
 SUM(CASE WHEN report.Code = 'S78' THEN 1 ELSE 0 END) S78,              
 SUM(CASE WHEN report.Code = 'S79' THEN 1 ELSE 0 END) S79,              
 SUM(CASE WHEN report.Code = 'S80' THEN 1 ELSE 0 END) S80,        
 SUM(CASE WHEN report.Code = 'S82' THEN 1 ELSE 0 END) S82,        
 SUM(CASE WHEN report.Code = 'S83' THEN 1 ELSE 0 END) S83,              
 SUM(CASE WHEN report.Code = 'S84' THEN 1 ELSE 0 END) S84,              
 SUM(CASE WHEN report.Code = 'S85' THEN 1 ELSE 0 END) S85,              
 SUM(CASE WHEN report.Code = 'S88' THEN 1 ELSE 0 END) S88,    
 SUM(CASE WHEN report.Code = 'S801' THEN 1 ELSE 0 END) S801,        
 SUM(CASE WHEN report.Code = 'S802' THEN 1 ELSE 0 END) S802,        
 SUM(CASE WHEN report.Code = 'S803' THEN 1 ELSE 0 END) S803,      
 SUM(CASE WHEN report.Code = 'S806' THEN 1 ELSE 0 END) S806,      
 SUM(CASE WHEN report.Code = 'S807' THEN 1 ELSE 0 END) S807,      
 SUM(CASE WHEN report.Code = 'S90' THEN 1 ELSE 0 END) S90,      
 SUM(CASE WHEN report.Code = 'S92' THEN 1 ELSE 0 END)S92,      
 SUM(CASE WHEN report.Code = 'S511' THEN 1 ELSE 0 END) S511,        
 SUM(CASE WHEN report.Code = 'S512' THEN 1 ELSE 0 END) S512,      
 SUM(CASE WHEN report.Code = 'S701' THEN 1 ELSE 0 END) S701,        
 SUM(CASE WHEN report.Code = 'S702' THEN 1 ELSE 0 END) S702,      
 SUM(CASE WHEN report.Code = 'S703' THEN 1 ELSE 0 END) S703,      
 SUM(CASE WHEN report.Code = 'S704' THEN 1 ELSE 0 END) S704,      
 SUM(CASE WHEN report.Code = 'S705' THEN 1 ELSE 0 END) S705,      
 SUM(CASE WHEN report.Code = 'S707' THEN 1 ELSE 0 END) S707,      
 SUM(CASE WHEN report.Code = 'S708' THEN 1 ELSE 0 END) S708,      
 SUM(CASE WHEN report.Code = 'S706' THEN 1 ELSE 0 END) S706,      
 SUM(CASE WHEN report.Code = 'S402' THEN 1 ELSE 0 END) S402,      
 SUM(CASE WHEN report.Code = 'S86' THEN 1 ELSE 0 END) S86,      
 SUM(CASE WHEN report.Code = 'S87' THEN 1 ELSE 0 END) S87,    
 SUM(CASE WHEN report.Code = 'S89' THEN 1 ELSE 0 END) S89,    
 SUM(CASE WHEN report.Code = 'S95' THEN 1 ELSE 0 END) S95 ,    
 SUM(CASE WHEN report.Code = 'S49' THEN 1 ELSE 0 END) S49 ,    
 SUM(CASE WHEN report.Code = 'S513' THEN 1 ELSE 0 END) S513 ,    
 SUM(CASE WHEN report.Code = 'S401' THEN 1 ELSE 0 END) S401,    
 SUM(CASE WHEN report.Code = 'S501' THEN 1 ELSE 0 END) S501,    
 SUM(CASE WHEN report.Code = 'S502' THEN 1 ELSE 0 END) S502,    
 SUM(CASE WHEN report.Code = 'S503' THEN 1 ELSE 0 END) S503,    
 SUM(CASE WHEN report.Code = 'S504' THEN 1 ELSE 0 END) S504,    
 SUM(CASE WHEN report.Code = 'S505' THEN 1 ELSE 0 END) S505,    
 SUM(CASE WHEN report.Code = 'S506' THEN 1 ELSE 0 END) S506,    
 SUM(CASE WHEN report.Code = 'S507' THEN 1 ELSE 0 END) S507,    
 SUM(CASE WHEN report.Code = 'S508' THEN 1 ELSE 0 END) S508,    
 SUM(CASE WHEN report.Code = 'S509' THEN 1 ELSE 0 END) S509,    
 SUM(CASE WHEN report.Code = 'S510' THEN 1 ELSE 0 END) S510 ,    
 SUM(CASE WHEN report.Code = 'S817' THEN 1 ELSE 0 END) S817   ,    
 SUM(CASE WHEN report.Code = 'S91' THEN 1 ELSE 0 END) S91 ,    
 SUM(CASE WHEN report.Code = 'S96' THEN 1 ELSE 0 END) S96 ,    
 SUM(CASE WHEN report.Code = 'S97' THEN 1 ELSE 0 END) S97 ,    
 SUM(CASE WHEN report.Code = 'S98' THEN 1 ELSE 0 END) S98 ,    
 SUM(CASE WHEN report.Code = 'S808' THEN 1 ELSE 0 END) S808 ,    
  SUM(CASE WHEN report.Code = 'S809' THEN 1 ELSE 0 END) S809,    
SUM(CASE WHEN report.Code = 'S810' THEN 1 ELSE 0 END) S810 ,    
SUM(CASE WHEN report.Code = 'S811' THEN 1 ELSE 0 END) S811,    
SUM(CASE WHEN report.Code = 'S812' THEN 1 ELSE 0 END) S812,    
SUM(CASE WHEN report.Code = 'S514' THEN 1 ELSE 0 END) S514,    
 SUM(CASE WHEN report.Code = 'S515' THEN 1 ELSE 0 END) S515,    
  SUM(CASE WHEN report.Code = 'S517' THEN 1 ELSE 0 END) S517,    
  SUM(CASE WHEN report.Code = 'S516' THEN 1 ELSE 0 END) S516,    
  SUM(CASE WHEN report.Code = 'S99' THEN 1 ELSE 0 END) S99,    
  SUM(CASE WHEN report.Code = 'S520' THEN 1 ELSE 0 END) S520,    
SUM(CASE WHEN report.Code = 'S522' THEN 1 ELSE 0 END) S522,    
SUM(CASE WHEN report.Code = 'S101' THEN 1 ELSE 0 END) S101,    
SUM(CASE WHEN report.Code = 'S804' THEN 1 ELSE 0 END) S804,    
SUM(CASE WHEN report.Code = 'S103' THEN 1 ELSE 0 END) S103,    
SUM(CASE WHEN report.Code = 'S100' THEN 1 ELSE 0 END) S100,    
SUM(CASE WHEN report.Code = 'S521' THEN 1 ELSE 0 END) S521,    
SUM(CASE WHEN report.Code = 'S519' THEN 1 ELSE 0 END) S519,    
 SUM(CASE WHEN report.Code = 'S108' THEN 1 ELSE 0 END) S108,    
 SUM(CASE WHEN report.Code = 'S107' THEN 1 ELSE 0 END) S107,    
 SUM(CASE WHEN report.Code = 'S105' THEN 1 ELSE 0 END) S105,    
 SUM(CASE WHEN report.Code = 'S106' THEN 1 ELSE 0 END) S106,    
  SUM(CASE WHEN report.Code = 'S110' THEN 1 ELSE 0 END) S110,    
  SUM(CASE WHEN report.Code = 'S102' THEN 1 ELSE 0 END) S102,    
  SUM(CASE WHEN report.Code = 'S104' THEN 1 ELSE 0 END) S104,    
  SUM(CASE WHEN report.Code = 'S814' THEN 1 ELSE 0 END) S814,    
  SUM(CASE WHEN report.Code = 'S815' THEN 1 ELSE 0 END) S815,    
SUM(CASE WHEN report.Code = 'S111' THEN 1 ELSE 0 END) S111,    
SUM(CASE WHEN report.Code = 'S518' THEN 1 ELSE 0 END) S518   ,    
SUM(CASE WHEN report.Code = 'S112' THEN 1 ELSE 0 END) S112 ,    
SUM(CASE WHEN report.Code = 'S114' THEN 1 ELSE 0 END) S114   ,    
SUM(CASE WHEN report.Code = 'S115' THEN 1 ELSE 0 END) S115 ,    
SUM(CASE WHEN report.Code = 'S113' THEN 1 ELSE 0 END) S113,              
SUM(CASE WHEN report.Code = 'S116' THEN 1 ELSE 0 END) S116,    
SUM(CASE WHEN report.Code = 'S118' THEN 1 ELSE 0 END) S118,    
SUM(CASE WHEN report.Code = 'S117' THEN 1 ELSE 0 END) S117,    
SUM(CASE WHEN report.Code = 'S119' THEN 1 ELSE 0 END) S119,    
SUM(CASE WHEN report.Code = 'S523' THEN 1 ELSE 0 END) S523,    
SUM(CASE WHEN report.Code = 'S120' THEN 1 ELSE 0 END) S120,    
SUM(CASE WHEN report.Code = 'S122' THEN 1 ELSE 0 END) S122,    
SUM(CASE WHEN report.Code = 'S121' THEN 1 ELSE 0 END) S121,    
SUM(CASE WHEN report.Code = 'S123' THEN 1 ELSE 0 END) S123,    
SUM(CASE WHEN report.Code = 'S525' THEN 1 ELSE 0 END) S525,    
SUM(CASE WHEN report.Code = 'S524' THEN 1 ELSE 0 END) S524,    
SUM(CASE WHEN report.Code = 'S126' THEN 1 ELSE 0 END) S126,    
SUM(CASE WHEN report.Code = 'S127' THEN 1 ELSE 0 END) S127,    
SUM(CASE WHEN report.Code = 'S526' THEN 1 ELSE 0 END) S526,    
SUM(CASE WHEN report.Code = 'S129' THEN 1 ELSE 0 END) S129,    
         SUM(CASE WHEN report.Code = 'S124' THEN 1 ELSE 0 END) S124 ,    
         SUM(CASE WHEN report.Code = 'S128' THEN 1 ELSE 0 END) S128 ,    
         SUM(CASE WHEN report.Code = 'S125' THEN 1 ELSE 0 END) S125 ,    
         SUM(CASE WHEN report.Code = 'S144' THEN 1 ELSE 0 END) S144,    
SUM(CASE WHEN report.Code = 'S145' THEN 1 ELSE 0 END) S145,    
SUM(CASE WHEN report.Code =